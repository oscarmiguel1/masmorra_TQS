name: Verificar espaciado entre l√≠neas

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  check-line-spacing:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v4
      
      - name: Verificar espaciado m√°ximo de 1 l√≠nea
        run: |
          echo "Verificando espaciado entre l√≠neas..."
          
          # Buscar archivos con m√°s de una l√≠nea en blanco consecutiva
          files_with_issues=$(find . -type f \( -name "*.py" -o -name "*.js" -o -name "*.ts" -o -name "*.java" -o -name "*.cpp" -o -name "*.c" -o -name "*.go" -o -name "*.rb" -o -name "*.php" \) -not -path "*/node_modules/*" -not -path "*/.git/*" -not -path "*/venv/*" -not -path "*/dist/*" -not -path "*/build/*")
          
          errors_found=0
          
          for file in $files_with_issues; do
            # Buscar dos o m√°s l√≠neas en blanco consecutivas
            if grep -Pzo '\n\n\n' "$file" > /dev/null 2>&1; then
              echo "‚ùå ERROR en $file: Se encontraron m√°s de una l√≠nea en blanco consecutiva"
              echo "   L√≠neas problem√°ticas:"
              grep -n '^$' "$file" | awk 'NR>1 && $1==p+1 && $1==pp+2 {print "   L√≠nea " pp ", " p ", " $1} {pp=p; p=$1}'
              errors_found=1
            fi
          done
          
          if [ $errors_found -eq 1 ]; then
            echo ""
            echo "üí° Por favor, elimina las l√≠neas en blanco adicionales. El m√°ximo permitido es 1 l√≠nea en blanco entre c√≥digo."
            exit 1
          else
            echo "‚úÖ Todas las verificaciones pasaron correctamente"
          fi
